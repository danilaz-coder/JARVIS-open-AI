import random
from datetime import datetime
from typing import Dict, Any, Optional, List

class PlankTimerBot:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞–º–∏ –ø–ª–∞–Ω–∫–∏ –¥–ª—è Telegram –±–æ—Ç–∞.
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤.
    """
    
    def init(self):
        self.active_timers: Dict[int, Dict[str, Any]] = {}
        self.motivations = [
            "üí™ –î–µ—Ä–∂–∏ —Å–ø–∏–Ω—É —Ä–æ–≤–Ω–æ!",
            "üî• –ï—â—ë –Ω–µ–º–Ω–æ–≥–æ, —Ç—ã —Å–º–æ–∂–µ—à—å!",
            "üöÄ –ù–µ —Å–¥–∞–≤–∞–π—Å—è, –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ!",
            "üèÜ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–π!",
            "üåü –¢—ã –º–æ–ª–æ–¥–µ—Ü, —Ç–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!",
            "‚ö° –°–æ–±–µ—Ä–∏—Å—å, —Ç—ã —Å–∏–ª—å–Ω–µ–µ!",
            "üéØ –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ –¥—ã—Ö–∞–Ω–∏–∏!",
            "ü¶æ –¢–≤–æ–∏ –º—ã—à—Ü—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∂–µ–ª–µ–∑–Ω—ã–º–∏!",
            "‚ú® –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–∏ —Å–µ–±—è –∫–∞–∂–¥—ã–π —Ä–∞–∑!",
            "ü•á –ë—É–¥–µ—à—å —á–µ–º–ø–∏–æ–Ω–æ–º –ø–æ –ø–ª–∞–Ω–∫–µ!"
        ]
    
    def generate_time(self, difficulty: str = "medium") -> int:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –ø–ª–∞–Ω–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏."""
        times = {
            "easy": (30, 60),
            "medium": (45, 90), 
            "hard": (60, 120),
            "extreme": (90, 180)
        }
        
        if difficulty in times:
            min_t, max_t = times[difficulty]
            return random.randint(min_t, max_t)
        
        return random.randint(30, 90)
    
    def format_time(self, seconds: int) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–µ–∫—É–Ω–¥—ã –≤ MM:SS."""
        return f"{seconds//60:02d}:{seconds%60:02d}"
    
    def start(self, chat_id: int, duration: Optional[int] = None, 
              difficulty: str = "medium") -> str:
        """–ù–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –ø–ª–∞–Ω–∫–∏."""
        if duration is None:
            duration = self.generate_time(difficulty)
        
def start_plank(self, chat_id: int, duration: int):
    """–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - —Ç–æ–ª—å–∫–æ start_time"""
    # –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤—ã—á–∏—Å–ª—è–µ–º
    self.active_timers[chat_id] = {
        "start_time": datetime.now(),
        "duration": duration
    }
    # current –≤—ã—á–∏—Å–ª—è–µ–º –Ω–∞ –ª–µ—Ç—É, –Ω–µ —Ö—Ä–∞–Ω–∏–º
        
        motivation = random.choice(self.motivations)
        return (f"ü™ô *–ë–†–û–°–û–ö –ú–û–ù–ï–¢–ö–ò –ù–ê –í–†–ï–ú–Ø!*\n\n"
                f"–í–∞–º –≤—ã–ø–∞–ª–æ: *{duration} —Å–µ–∫—É–Ω–¥* –ø–ª–∞–Ω–∫–∏!\n\n"
                f"‚è±Ô∏è *–¢–ê–ô–ú–ï–† –ó–ê–ü–£–©–ï–ù!*\n"
                f"‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: {self.format_time(duration)}\n"
                f"üí™ {motivation}\n\n"
                f"üéØ *–°–û–í–ï–¢:* –î–µ—Ä–∂–∏ —Å–ø–∏–Ω—É –ø—Ä—è–º–æ!")
    
    def update(self, chat_id: int) -> Optional[str]:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–π–º–µ—Ä –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ."""
        if chat_id not in self.active_timers:
            return None
        
        timer = self.active_timers[chat_id]
        
        if not timer["is_active"]:
            return None
        
        elapsed = (datetime.now() - timer["start_time"]).seconds
        remaining = max(0, timer["duration"] - elapsed)
        timer["remaining"] = remaining
        
        if remaining <= 0:
            return self.finish(chat_id)
        
        if remaining % 30 == 0 or remaining <= 10:
            motivation = random.choice(self.motivations)
            return f"‚è≥ *{self.format_time(remaining)}* –æ—Å—Ç–∞–ª–æ—Å—å!\n{motivation}"
        
        return None
    
    def finish(self, chat_id: int) -> Optional[str]:
        """–ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–∞–π–º–µ—Ä –ø–ª–∞–Ω–∫–∏."""
        if chat_id not in self.active_timers:
            return None
        
        timer = self.active_timers[chat_id]
        timer["is_active"] = False
        duration = timer["duration"]
        
        del self.active_timers[chat_id]
        
        congrats = [
            f"üéâ *–ü–õ–ê–ù–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!*\n\n‚úÖ –í—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∏—Å—å *{duration} —Å–µ–∫—É–Ω–¥*!",
            f"üèÜ *–û–¢–õ–ò–ß–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢!*\nüí™ {duration} —Å–µ–∫—É–Ω–¥ –ø–ª–∞–Ω–∫–∏ - —ç—Ç–æ –∫—Ä—É—Ç–æ!",
            f"üåü *–ú–û–õ–û–î–ï–¶!*\nüî• {duration} —Å–µ–∫—É–Ω–¥ - —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —Å–∏–ª—å–Ω–µ–µ!"
        ]
        
        return random.choice(congrats)
    
    def stop(self, chat_id: int) -> str:
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –¥–æ—Å—Ä–æ—á–Ω–æ."""

Daniel üåç Kanay üåêQA, [12/01/2026 23:57]
if chat_id not in self.active_timers:
            return "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–ª–∞–Ω–∫–∏!"
        
        timer = self.active_timers[chat_id]
        remaining = timer["remaining"]
        
        del self.active_timers[chat_id]
        
        return (f"‚èπÔ∏è *–¢–ê–ô–ú–ï–† –û–°–¢–ê–ù–û–í–õ–ï–ù*\n\n"
                f"–û—Å—Ç–∞–ª–æ—Å—å: {self.format_time(remaining)} —Å–µ–∫—É–Ω–¥\n"
                f"–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –ø–æ–∑–∂–µ! üí™")
    
    def status(self, chat_id: int) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–ª–∞–Ω–∫–∏."""
        if chat_id in self.active_timers:
            timer = self.active_timers[chat_id]
            return (f"‚è±Ô∏è *–ê–ö–¢–ò–í–ù–ê–Ø –ü–õ–ê–ù–ö–ê*\n\n"
                    f"–û—Å—Ç–∞–ª–æ—Å—å: {self.format_time(timer['remaining'])}\n"
                    f"–°–ª–æ–∂–Ω–æ—Å—Ç—å: {timer['difficulty']}")
        return "üîÑ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–ª–∞–Ω–∫–∏. –ù–∞—á–Ω–∏ –Ω–æ–≤—É—é: /plank"


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
plank_bot = PlankTimerBot()

def handle_plank_command(command: str, chat_id: int, *args) -> str:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥ –ø–ª–∞–Ω–∫–∏.
    
    Args:
        command: –¢–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥—ã
        chat_id: ID —á–∞—Ç–∞
        *args: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
        
    Returns:
        –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
    """
    cmd = command.lower().lstrip('/')
    
    if cmd in ["plank", "–ø–ª–∞–Ω–∫–∞", "—Ç–∞–π–º–µ—Ä"]:
        difficulty = "medium"
        if args and args[0]:
            arg = args[0].lower()
            if arg in ["–ª–µ–≥–∫–æ", "easy"]:
                difficulty = "easy"
            elif arg in ["—Å–ª–æ–∂–Ω–æ", "hard"]:
                difficulty = "hard"
        return plank_bot.start(chat_id, difficulty=difficulty)
    
    elif cmd in ["plank_stop", "—Å—Ç–æ–ø", "stop"]:
        return plank_bot.stop(chat_id)
    
    elif cmd in ["plank_status", "—Å—Ç–∞—Ç—É—Å"]:
        return plank_bot.status(chat_id)
    
    elif cmd in ["plank_time", "–≤—Ä–µ–º—è"]:
        if args and args[0]:
            try:
                seconds = int(args[0])
                if 10 <= seconds <= 300:
                    return plank_bot.start(chat_id, duration=seconds)
                return "‚ùå –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –æ—Ç 10 –¥–æ 300 —Å–µ–∫—É–Ω–¥!"
            except ValueError:
                return "‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ —Å–µ–∫—É–Ω–¥!"
        return "–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è: /plank_time 60"
    
    return (
        "‚è±Ô∏è *–ö–û–ú–ê–ù–î–´ –ü–õ–ê–ù–ö–ò:*\n\n"
        "üé≤ /plank - –°–ª—É—á–∞–π–Ω–∞—è –ø–ª–∞–Ω–∫–∞ (30-90 —Å–µ–∫)\n"
        "‚ö° /plank –ª–µ–≥–∫–æ - –õ—ë–≥–∫–∞—è –ø–ª–∞–Ω–∫–∞ (30-60 —Å–µ–∫)\n"
        "üî• /plank —Å–ª–æ–∂–Ω–æ - –°–ª–æ–∂–Ω–∞—è –ø–ª–∞–Ω–∫–∞ (60-120 —Å–µ–∫)\n"
        "‚è±Ô∏è /plank_time X - –ü–ª–∞–Ω–∫–∞ –Ω–∞ X —Å–µ–∫—É–Ω–¥\n"
        "üõë /—Å—Ç–æ–ø - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä\n"
        "üìä /—Å—Ç–∞—Ç—É—Å - –°—Ç–∞—Ç—É—Å —Ç–µ–∫—É—â–µ–π –ø–ª–∞–Ω–∫–∏"
    )

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
PLANK_MENU = (
    "‚è±Ô∏è *–¢–ê–ô–ú–ï–† –ü–õ–ê–ù–ö–ò*\n\n"
    "–í—ã–±–µ—Ä–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:\n"
    "[üé≤ –õ–µ–≥–∫–∞—è (30-60—Å)] [‚ö° –°—Ä–µ–¥–Ω—è—è (45-90—Å)]\n"
    "[üî• –°–ª–æ–∂–Ω–∞—è (60-120—Å)]\n\n"
    "–ò–ª–∏ —É–∫–∞–∂–∏ —Å–≤–æ—ë –≤—Ä–µ–º—è:\n"
    "/plank_time 60"
)

def main():
    """–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è."""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PlankTimerBot")
    print("=" * 40)
    
    # –¢–µ—Å—Ç 1
    print("\n1. –°–ª—É—á–∞–π–Ω–∞—è –ø–ª–∞–Ω–∫–∞:")
    print(handle_plank_command("/plank", 123456))
    
    # –¢–µ—Å—Ç 2  
    print("\n2. –°—Ç–∞—Ç—É—Å:")
    print(handle_plank_command("/—Å—Ç–∞—Ç—É—Å", 123456))
    
    # –¢–µ—Å—Ç 3
    print("\n3. –ü–ª–∞–Ω–∫–∞ –Ω–∞ 45 —Å–µ–∫—É–Ω–¥:")
    print(handle_plank_command("/plank_time", 123456, "45"))
    
    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")

if name == "main":
    main()
     
